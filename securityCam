from gpiozero import MotionSensor
from picamera import PiCamera
import time
import datetime
import smtplib


pir = MotionSensor(7)

camera = PiCamera()
camera.resolution = (2592, 1944)
camera.framerate = 15
camera.rotation = 180
def getFileName():
    return datetime.datetime.now().strftime("%Y-%-m-%d_%H.%M.%S.jpg")


while True:
    filename = getFileName()
    pir.wait_for_motion
    
    print("Betolakodot erzekeltem")
    camera.start_preview()
    camera.capture(filename)
    time.sleep(2)
    camera.stop_preview()
    
    smtpUser = 'ddax.kn@gmail.com'
    smtpPass = 'mell0n0sS'

    toAdd = 'raysmax.dnd@gmail.com'
    fromAdd = smtpUser

    subject = 'Betolakodo'
    header = 'To: ' + toAdd + '\n' + 'From: ' + fromAdd + '\n' + 'Subject: ' + subject
    body = 'Betolakodot eszleltem!'

    s = smtplib.SMTP('smtp.gmail.com', 587)
    s.ehlo()
    s.starttls()
    s.ehlo()

    s.login(smtpUser, smtpPass)
    s.sendmail(fromAdd, toAdd, header + '\n\n' +body)
    s.quit()
    
    
    time.sleep(10)
